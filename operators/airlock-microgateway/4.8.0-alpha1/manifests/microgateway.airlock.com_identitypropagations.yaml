apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  labels:
    app.kubernetes.io/name: airlock-microgateway-operator
    app.kubernetes.io/version: 4.8.0-alpha1
  name: identitypropagations.microgateway.airlock.com
spec:
  group: microgateway.airlock.com
  names:
    categories:
    - airlock-microgateway
    kind: IdentityPropagation
    listKind: IdentityPropagationList
    plural: identitypropagations
    singular: identitypropagation
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: IdentityPropagation defines an identity propagation operation.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired identity propagation.
            properties:
              bearerToken:
                description: bearerToken configures identity propagation via an authorization
                  header containing a bearer token.
                properties:
                  source:
                    description: source from which to extract the token.
                    properties:
                      clientCertificate:
                        description: clientCertificate specifies to extract a value
                          from the presented client certificate.
                        properties:
                          issuer:
                            description: issuer specifies to extract the value from
                              the presented client certificate's issuer.
                            properties:
                              field:
                                description: |-
                                  field specifies the field to extract as value.
                                  If the certificate contains multiple occurrences of the field, all their values are joined into a comma-separated list.
                                enum:
                                - CommonName
                                - Organization
                                - OrganizationalUnit
                                - Country
                                - State
                                - Locality
                                type: string
                            required:
                            - field
                            type: object
                          san:
                            description: san specifies to extract the value from the
                              presented client certificate's subject alternative names.'
                            properties:
                              type:
                                description: |-
                                  type specifies to extract subject alternative names with this type.
                                  If there are multiple such SANs, they are joined into a comma-separated list.
                                enum:
                                - DNS
                                - Email
                                - URI
                                - IPAddress
                                type: string
                            required:
                            - type
                            type: object
                          subject:
                            description: subject specifies to extract the value from
                              the presented client certificate's subject.
                            properties:
                              field:
                                description: |-
                                  field specifies the field to extract as value.
                                  If the certificate contains multiple occurrences of the field, all their values are joined into a comma-separated list.
                                enum:
                                - CommonName
                                - Organization
                                - OrganizationalUnit
                                - Country
                                - State
                                - Locality
                                type: string
                            required:
                            - field
                            type: object
                        type: object
                      jwt:
                        description: jwt specifies to extract a value from a JWT.
                        properties:
                          claim:
                            description: claim specifies the JWT claim to extract
                              as value. If omitted, the entire JWT will be used as
                              value.
                            maxLength: 1024
                            minLength: 1
                            type: string
                        type: object
                      metadata:
                        description: metadata specifies to extract a value from an
                          Envoy dynamic filter metadata key.
                        properties:
                          key:
                            description: key specifies the metadata key from which
                              to load the value, e.g. `some_payload.aud`.
                            maxLength: 1024
                            minLength: 1
                            type: string
                          namespace:
                            description: namespace specifies the metadata namespace
                              within which the lookup should be performed, e.g. `envoy.filters.http.jwt_authn`.
                            maxLength: 1024
                            minLength: 1
                            type: string
                        required:
                        - key
                        - namespace
                        type: object
                      oidc:
                        description: oidc specifies to extract a value from the result
                          of an OpenID Connect flow.
                        properties:
                          accessToken:
                            description: accessToken specifies to extract the value
                              from the OpenID Connect Access Token.
                            type: object
                          idToken:
                            description: idToken specifies to extract the value from
                              the OpenID Connect ID Token.
                            properties:
                              claim:
                                description: claim specifies the JWT claim to extract
                                  as value.
                                maxLength: 1024
                                minLength: 1
                                type: string
                            required:
                            - claim
                            type: object
                        type: object
                      tokenExchange:
                        description: tokenExchange specifies to use the token obtained
                          via token exchange as value.
                        properties:
                          claim:
                            description: |-
                              claim specifies the JWT claim to extract as value. If omitted, the entire token will be used as value.
                              Note: If claim is specified, identity propagation will fail if the token obtained from the exchange is not a JWT.
                            maxLength: 1024
                            minLength: 1
                            type: string
                        type: object
                    type: object
                required:
                - source
                type: object
              header:
                description: header configures identity propagation via a request
                  header.
                properties:
                  name:
                    description: name of the header to set.
                    maxLength: 256
                    minLength: 1
                    type: string
                  value:
                    description: value to propagate to the application.
                    properties:
                      source:
                        description: source from which to extract the value.
                        properties:
                          clientCertificate:
                            description: clientCertificate specifies to extract a
                              value from the presented client certificate.
                            properties:
                              issuer:
                                description: issuer specifies to extract the value
                                  from the presented client certificate's issuer.
                                properties:
                                  field:
                                    description: |-
                                      field specifies the field to extract as value.
                                      If the certificate contains multiple occurrences of the field, all their values are joined into a comma-separated list.
                                    enum:
                                    - CommonName
                                    - Organization
                                    - OrganizationalUnit
                                    - Country
                                    - State
                                    - Locality
                                    type: string
                                required:
                                - field
                                type: object
                              san:
                                description: san specifies to extract the value from
                                  the presented client certificate's subject alternative
                                  names.'
                                properties:
                                  type:
                                    description: |-
                                      type specifies to extract subject alternative names with this type.
                                      If there are multiple such SANs, they are joined into a comma-separated list.
                                    enum:
                                    - DNS
                                    - Email
                                    - URI
                                    - IPAddress
                                    type: string
                                required:
                                - type
                                type: object
                              subject:
                                description: subject specifies to extract the value
                                  from the presented client certificate's subject.
                                properties:
                                  field:
                                    description: |-
                                      field specifies the field to extract as value.
                                      If the certificate contains multiple occurrences of the field, all their values are joined into a comma-separated list.
                                    enum:
                                    - CommonName
                                    - Organization
                                    - OrganizationalUnit
                                    - Country
                                    - State
                                    - Locality
                                    type: string
                                required:
                                - field
                                type: object
                            type: object
                          jwt:
                            description: jwt specifies to extract a value from a JWT.
                            properties:
                              claim:
                                description: claim specifies the JWT claim to extract
                                  as value. If omitted, the entire JWT will be used
                                  as value.
                                maxLength: 1024
                                minLength: 1
                                type: string
                            type: object
                          metadata:
                            description: metadata specifies to extract a value from
                              an Envoy dynamic filter metadata key.
                            properties:
                              key:
                                description: key specifies the metadata key from which
                                  to load the value, e.g. `some_payload.aud`.
                                maxLength: 1024
                                minLength: 1
                                type: string
                              namespace:
                                description: namespace specifies the metadata namespace
                                  within which the lookup should be performed, e.g.
                                  `envoy.filters.http.jwt_authn`.
                                maxLength: 1024
                                minLength: 1
                                type: string
                            required:
                            - key
                            - namespace
                            type: object
                          oidc:
                            description: oidc specifies to extract a value from the
                              result of an OpenID Connect flow.
                            properties:
                              accessToken:
                                description: accessToken specifies to extract the
                                  value from the OpenID Connect Access Token.
                                type: object
                              idToken:
                                description: idToken specifies to extract the value
                                  from the OpenID Connect ID Token.
                                properties:
                                  claim:
                                    description: claim specifies the JWT claim to
                                      extract as value.
                                    maxLength: 1024
                                    minLength: 1
                                    type: string
                                required:
                                - claim
                                type: object
                            type: object
                          tokenExchange:
                            description: tokenExchange specifies to use the token
                              obtained via token exchange as value.
                            properties:
                              claim:
                                description: |-
                                  claim specifies the JWT claim to extract as value. If omitted, the entire token will be used as value.
                                  Note: If claim is specified, identity propagation will fail if the token obtained from the exchange is not a JWT.
                                maxLength: 1024
                                minLength: 1
                                type: string
                            type: object
                        type: object
                    required:
                    - source
                    type: object
                required:
                - name
                - value
                type: object
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: null
  storedVersions: null

---
apiVersion: bonree.com/v1alpha1
kind: SmartKube
metadata:
  name: smartkube
  namespace: bonree-agent
spec:
  # Bonree APM base API URL
  apiUrl: https://one.bonree.com/rest/apm/agentDown

  # Probe connection related configuration
  controllerInfo:
    controllerUrl: https://oneupload.bonree.com/APM
    logControllerUrl: https://onelog.joinbr.com/controller/logs
    accountGUID: <accountGUID>

  # Enabled probe types
  # In full-stack monitoring mode, default value, do not modify
  # In application-only monitoring mode, default value: "java,php,dotnet,python,nodejs,nginx,go,apache"
  agentTypes: "java,php,dotnet,python,nodejs,nginx,go,apache"

  # [Optional] Specify network zone
  # Default: not set
  # networkZone: default

  # [Optional] Specify cluster name
  # Default: not set
  # clusterName: default

  # [Optional] Specify environment ID
  # Default: not set
  # envId: default

  # [Optional]: Specify the secret name for storing token
  # Default value is smartkube
  # tokens: ""

  # [Optional]: Skip certificate verification when downloading packages or making API requests
  # Default: false
  # skipCertCheck: false

  # [1.1.0+] [SmartAgent 9.1.0+] [Optional]: Specify host attributes (data center)
  # Default: not set
  # Format: "k=v,k1=v1"
  # hostAttributes: ""

  # [1.1.0+] [SmartAgent 9.1.0+] [Optional]: Specify host tags
  # Default: not set
  # Format: "k=v,k1=v1"
  # hostTags: ""

  # When enabling full-stack installation, configure smartagent image and auto-update
  # smartAgent:
  #
  #   [Optional]: Custom SmartAgent container image name.
  #   Default value: docker.bonree.com/agent/smartagent:latest
  #
  #   image: ""

  #   [Optional]: When SmartAgent version changes, automatically restart SmartAgent pod instances to update version (check every 15 minutes)
  #   Default value: true
  #   autoUpdate: true

  # Full-stack monitoring
  classicFullStack:
    # Enable full-stack installation
    enabled: true

    # [Optional]: SmartAgent deployment node selection constraints.
    # See details: https://kubernetes.io/zh/docs/concepts/scheduling-eviction/assign-pod-node/
    # nodeSelector: {}

    # [Optional]: SmartAgent deployment node affinity constraints.
    # See details: https://kubernetes.io/zh/docs/concepts/scheduling-eviction/taint-and-toleration/
    tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/master
        operator: Exists
      - effect: NoSchedule
        key: node-role.kubernetes.io/control-plane
        operator: Exists

    # [Optional]: SmartAgent installation parameters.
    # args: []

    # [Optional]: Add extra environment variables for SmartAgent Pods
    #
    # env: []

    # [Optional]: Set SmartAgent Pods priority. Default is not set.
    # See details: https://kubernetes.io/zh/docs/concepts/scheduling-eviction/pod-priority-preemption/
    #
    # priorityClassName: priority-class

    # [Optional]: SmartAgent pods DNS Policy. Default value: ClusterFirstWithHostNet.
    # See details: https://kubernetes.io/zh/docs/concepts/services-networking/dns-pod-service/
    #
    # dnsPolicy: "ClusterFirstWithHostNet"

    # [Optional]: Specify the ServiceAccount name assigned to SmartAgent Pods. Default value: "bonree-smartagent"
    #
    # serviceAccountName: service-account-name

    # [Optional]: Add extra labels to SmartAgent Pods
    #
    # labels:
    #   custom: label

    # [Optional]: SmartAgent container instance resource limits. Please adjust to appropriate values.
    # See details: https://kubernetes.io/zh/docs/concepts/configuration/manage-resources-containers/
    resources:
      requests:
        cpu: 100m
        memory: 512Mi
      limits:
        cpu: 800m
        memory: 1.5Gi

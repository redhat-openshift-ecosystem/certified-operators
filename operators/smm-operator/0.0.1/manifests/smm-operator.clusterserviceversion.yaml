---
apiVersion: operators.coreos.com/v1alpha1
kind: ClusterServiceVersion
metadata:
  annotations:
    alm-examples: |-
      [
        {
          "apiVersion": "smm.cisco.com/v1alpha1",
          "kind": "ControlPlane",
          "metadata": {
            "name": "smm"
          },
          "spec": {
            "platform": "openshift",
            "clusterName": "<cluster-name>",
            "certManager": {
              "enabled": true,
              "namespace": "cert-manager"
            },
            "clusterRegistry": {
              "enabled": true,
              "namespace": "cluster-registry"
            },
            "log": {},
            "meshManager": {
              "enabled": true,
              "namespace": "smm-system",
              "istio": {
                "enabled": true,
                "istioCRRef": {
                  "name": "cp-v115x",
                  "namespace": "istio-system"
                }
              }
            },
            "nodeExporter": {
              "enabled": true,
              "namespace": "smm-system",
              "psp": {
                "enabled": false
              },
              "rbac": {
                "enabled": true
              }
            },
            "oneEye": {},
            "registryAccess": {
              "enabled": true,
              "namespace": "smm-registry-access",
              "imagePullSecretsController": {},
              "pullSecrets": [
                {
                  "name": "smm-registry.eticloud.io-pull-secret",
                  "namespace": "smm-registry-access"
                }
              ]
            },
            "repositoryOverride": {
              "host": "registry.eticloud.io",
              "prefix": "smm"
            },
            "role": "active",
            "smm": {
              "enabled": true,
              "namespace": "smm-system",
              "releaseName": "smm",
              "role": "active",
              "useIstioResources": true,
              "log": {},
              "prometheusOperator": {},
              "als": {
                "enabled": true,
                "log": {}
              },
              "application": {
                "enabled": true,
                "log": {}
              },
              "auth": {
                "node": "impersonation"
              },
              "certmanager": {
                "enabled": true
              },
              "federationGateway": {
                "enabled": true,
                "name": "smm",
                "service": {
                  "enabled": true,
                  "name": "smm-federation-gateway",
                  "port": 80
                }
              },
              "federationGatewayOperator": {
                "enabled": true
              },
              "impersonation": {
                "enabled": true
              },
              "istio": {
                "revision": "cp-v115x.istio-system"
              },
              "leo": {
                "enabled": true,
                "log": {}
              },
              "sre": {
                "enabled": true
              },
              "prometheus": {
                "enabled": true,
                "replicas": 1
              }
            }
          }
        }
      ]
    capabilities: Basic Install
    createdAt: "2023-04-10T02:44:38Z"
    operators.operatorframework.io/builder: operator-sdk-v1.28.0
    operators.operatorframework.io/project_layout: helm.sdk.operatorframework.io/v1
  name: smm-operator.v0.0.1
  namespace: placeholder
spec:
  apiservicedefinitions: {}
  customresourcedefinitions:
    owned:
    - description: Service Mesh Manager Control Plane Resource
      kind: ControlPlane
      name: controlplanes.smm.cisco.com
      displayName: Control Plane Resource
      version: v1alpha1
  description: |
    An enterprise ready Istio platform for DevOps and SREs that automates lifecycle management and simplifies connectivity, security & observability for
    microservice based applications.

    ### Prerequisites
    1. Create two namespaces, one for smm-operator (called smm-registry-access), and one for cert-manager:

        ```
        $ kubectl create ns smm-registry-access
        $ kubectl create ns cert-manager
        ```

    2. Add a secret within the smm-operator namespace. If you don't have registry credentials, get it from [here](https://calisti.app/download)

        ```
        $ kubectl create secret docker-registry smm-registry.eticloud.io-pull-secret --docker-server=registry.eticloud.io --docker-username=<your-username> \
            --docker-password=<your-password> -n smm-registry-access
        ```

  displayName: The Cisco Service Mesh Manager
  icon:
  - base64data: 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
    mediatype: image/png
  install:
    spec:
      clusterPermissions:
      - rules:
        - apiGroups:
          - ""
          - apps
          - autoscaling
          - batch
          - extensions
          - policy
          - admissionregistration.k8s.io
          - authentication.k8s.io
          - authorization.k8s.io
          - certificates.k8s.io
          - networking.k8s.io
          - storage.k8s.io
          - smm.cisco.com
          - deployments.banzaicloud.io
          - graphql.cisco.com
          - images.banzaicloud.io
          - health.smm.cisco.com
          - istio.banzaicloud.io
          - sre.smm.cisco.com
          - acme.cert-manager.io
          - authentication.istio.io
          - cert-manager.io
          - networking.istio.io
          - networking.istio.io
          - security.istio.io
          - k8s.cni.cncf.io
          resources:
          - "*"
          verbs:
          - "*"
        - apiGroups: ["*"]
          resources:
          - "*"
          verbs:
          - get
          - list
          - watch
        # cert manager chart
        - apiGroups:
          - ""
          - extensions
          - admissionregistration.k8s.io
          - apiextensions.k8s.io
          - apiregistration.k8s.io
          - cert-manager.io
          - acme.cert-manager.io
          - route.openshift.io
          resources:
          - "*"
          verbs:
          - "*"
        # istio operator chart
        - apiGroups:
          - ""
          - apps
          - autoscaling
          - extensions
          - policy
          - admissionregistration.k8s.io
          - apiextensions.k8s.io
          - authentication.k8s.io
          - authorization.k8s.io
          - certificates.k8s.io
          - discovery.k8s.io
          - networking.k8s.io
          - rbac.authorization.k8s.io
          - networking.x-k8s.io
          - istio.banzaicloud.io
          - authentication.istio.io
          - cloud.istio.io
          - config.istio.io
          - istio.istio.io
          - networking.istio.io
          - rbac.istio.io
          - scalingpolicy.istio.io
          - security.istio.io
          - servicemesh.cisco.com
          - clusterregistry.k8s.cisco.com
          resources:
          - "*"
          verbs:
          - "*"
        # node exporter chart
        - apiGroups:
          - extensions
          resources:
          - "*"
          verbs:
          - "*"
        # prometheus operator chart
        - apiGroups:
          - ""
          - apps
          - monitoring.smm.cisco.com
          - monitoring.coreos.com
          resources:
          - "*"
          verbs:
          - "*"
        # sre controller chart
        - apiGroups:
          - monitoring.smm.cisco.com
          - sre.smm.cisco.com
          - health.smm.cisco.com
          resources:
          - "*"
          verbs:
          - "*"
        # leaderelection
        - apiGroups:
          - coordination.k8s.io
          resources:
          - leases
          verbs:
          - get
          - list
          - watch
          - create
          - update
          - delete
        - apiGroups:
          - ""
          resources:
          - namespaces
          verbs:
          - get
        - apiGroups:
          - ""
          resources:
          - secrets
          verbs:
          - get
        - apiGroups:
          - ""
          resources:
          - events
          verbs:
          - create
        - apiGroups:
          - "smm.cisco.com"
          resources:
          - controlplanes
          - controlplanes/status
          - controlplanes/finalizers
          verbs:
          - create
          - delete
          - get
          - list
          - patch
          - update
          - watch
        - apiGroups:
          - rbac.authorization.k8s.io
          resources:
          - clusterrolebindings
          - clusterroles
          verbs:
          - '*'
        - apiGroups:
          - apps
          resources:
          - deployments
          - statefulsets
          verbs:
          - '*'
        - apiGroups:
          - ""
          resources:
          - secrets
          - serviceaccounts
          - services
          verbs:
          - '*'
        - apiGroups:
          - rbac.authorization.k8s.io
          resources:
          - rolebindings
          - roles
          verbs:
          - '*'
        - apiGroups:
          - authentication.k8s.io
          resources:
          - tokenreviews
          verbs:
          - create
        - apiGroups:
          - authorization.k8s.io
          resources:
          - subjectaccessreviews
          verbs:
          - create
        - apiGroups:
          - apiextensions.k8s.io
          resources:
          - customresourcedefinitions
          verbs:
          - '*'
        serviceAccountName: smm-operator
      deployments:
      - label:
          app.kubernetes.io/component: manager
          app.kubernetes.io/created-by: smm-operator
          app.kubernetes.io/instance: smm-operator
          app.kubernetes.io/managed-by: kustomize
          app.kubernetes.io/name: deployment
          app.kubernetes.io/part-of: smm-operator
          control-plane: smm-operator
        name: smm-operator
        spec:
          replicas: 1
          selector:
            matchLabels:
              control-plane: smm-operator
          strategy: {}
          template:
            metadata:
              annotations:
                kubectl.kubernetes.io/default-container: manager
              labels:
                control-plane: smm-operator
            spec:
              affinity:
                nodeAffinity:
                  requiredDuringSchedulingIgnoredDuringExecution:
                    nodeSelectorTerms:
                    - matchExpressions:
                      - key: kubernetes.io/arch
                        operator: In
                        values:
                        - amd64
                        - arm64
                        - ppc64le
                        - s390x
                      - key: kubernetes.io/os
                        operator: In
                        values:
                        - linux
              containers:
              - args:
                - --secure-listen-address=0.0.0.0:8443
                - --upstream=http://127.0.0.1:8080/
                - --logtostderr=true
                - --v=0
                - --tls-cipher-suites=TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_AES_256_GCM_SHA384,TLS_AES_128_GCM_SHA256
                image: registry.eticloud.io/smm/kube-rbac-proxy@sha256:433855cbd9f610a8b7ddf00f2de807e749e2abbdd02db9ef63550f6ba4c327cd
                name: kube-rbac-proxy
                ports:
                - containerPort: 8443
                  name: https
                resources:
                  limits:
                    cpu: 500m
                    memory: 128Mi
                  requests:
                    cpu: 5m
                    memory: 64Mi
                securityContext:
                  allowPrivilegeEscalation: false
                  capabilities:
                    drop:
                    - ALL
              - args:
                - --metrics.addr=127.0.0.1:8080
                - --leaderElection.enabled
                image: registry.eticloud.io/smm/smm-operator-rh-ubi8@sha256:7b36d8d19385a05835ff124072d028ceac291f8c3ff35324ed329f57051ebf04
                name: manager
                env:
                  - name: POD_NAMESPACE
                    valueFrom:
                      fieldRef:
                        fieldPath: metadata.namespace
                resources:
                  requests:
                    cpu: 200m
                    memory: 256Mi
                securityContext:
                  allowPrivilegeEscalation: false
                  capabilities:
                    drop:
                    - ALL
              securityContext:
                runAsNonRoot: true
              serviceAccountName: smm-operator
              imagePullSecrets: [{"name": "smm-registry.eticloud.io-pull-secret"}]
              terminationGracePeriodSeconds: 60
      permissions:
      - rules:
        - apiGroups:
          - ""
          resources:
          - configmaps
          verbs:
          - get
          - list
          - watch
          - create
          - update
          - patch
          - delete
        - apiGroups:
          - coordination.k8s.io
          resources:
          - leases
          verbs:
          - get
          - list
          - watch
          - create
          - update
          - patch
          - delete
        - apiGroups:
          - ""
          resources:
          - events
          verbs:
          - create
          - patch
        serviceAccountName: smm-operator
    strategy: deployment
  installModes:
  - supported: false
    type: OwnNamespace
  - supported: false
    type: SingleNamespace
  - supported: false
    type: MultiNamespace
  - supported: true
    type: AllNamespaces
  keywords:
  - Calisti
  - Service Mesh Manager
  maintainers:
    - email: rnasani@cisco.com
      name: Ravi Nasani
  links:
  - name: The Cisco Service Mesh Manager
    url: https://calisti.app/
  maturity: alpha
  minKubeVersion: 1.24.0
  provider:
    name: Cisco
    url: https://www.cisco.com
  version: 0.0.1
